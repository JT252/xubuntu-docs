<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN" 
"http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd" [
<!ENTITY % xubuntu-ent SYSTEM "../libs/xubuntu.ent">
%xubuntu-ent;
<!ENTITY % xinclude SYSTEM "../libs/xinclude.mod">
%xinclude;
<!ENTITY language "&EnglishAmerican;">
<!ENTITY language "C">
]>
<chapter id="offline-packages">
	<title>Offline Package Management</title>

	<para>The tool <application>apt-offline</application> is available to help keep your computer up to date even if it cannot be kept connected.  There are multiple steps involved in the process of doing this.  With a USB flash drive available to you, this can be managed.</para>

	<section id="offline-repo-update">
		<title>Updating Repositories</title>

		<para>After plugging in a USB flash drive and opening a terminal, you can use apt-offline to generate a request to update what your computer knows about software repositories.  This allows your computer to see if there are bug fixes and/or security updates available to apply to your computer.  This also allows you to know if new software is available.</para>

		<para>From your disconnected computer you enter this at the command line: <userinput>apt-offline set --update apt-offline.sig</userinput></para>

		<para>After that command is done and the <userinput>apt-offline.sig</userinput> is created, copy that to your USB flash drive and take it to another computer.  With apt-offline on that computer, you use that file to download what your disconnected computer needs to update itself.  Assuming you are in the terminal and in the directory on the flash drive containing <userinput>apt-offline.sig</userinput>, you enter <userinput>apt-offline get --bundle bundle.zip apt-offline.sig</userinput>.  Once that command is done, you can remove the USB flash drive and take it back to the disconnected computer.  Some errors in red text may show up about being unable to download files relative to translations but these can be safely ignored.</para>

		<para>Back at the disconnected computer, insert the USB flash drive.  Assuming you have opened a terminal and have navigated to the directory on the flash drive containing the two files you then enter: <userinput>sudo apt-offline install bundle.zip</userinput>.  You will see some program output scroll by and once it completes your repositories will be updated.</para> 
	</section>

	<section id="offline-package-install">
		<title>Installing a Package</title>

		<para>After plugging in a USB flash drive and opening a terminal, you can use apt-offline to grab a package to install.  This action can also be combined with updating your computer's understanding of the contents of the software repositories.  In a disconnected environment, using what connection opportunities you have to the max is key</para>

		<para>In this example, assume you want to install a new program package.  Throughout this we'll refer to this as <userinput>$PACKAGENAME</userinput> though in normal use you will want to enter just the package name you want without the dollar sign.  Fairly frequently installing <userinput>$PACKAGENAME</userinput> will result in the need to also grab dependencies instead of just a single package file.  <application>apt-offline</application> handles the dependencies resolution for you.  To start this process you need to open a terminal window, plug in a USB flash drive, and navigate to a directory on the flash drive.  From that directory you then enter at the command line to start the process: <userinput>sudo apt-offline set --install-packages $PACKAGENAME --update apt-offline.sig</userinput></para>

		<para>After that command is done and the <userinput>apt-offline.sig</userinput> is created, copy that to your USB flash drive and take it to another computer.  With apt-offline on that computer, you use that file to download what your disconnected computer needs to update itself.  Assuming you are in the terminal and in the directory on the flash drive containing <userinput>apt-offline.sig</userinput>, you enter <userinput>sudo apt-offline get --bundle bundle.zip apt-offline.sig</userinput>.  The command's output will show an attempt to download updates as to what the repositories look like as well as <application>$PACKAGENAME</application> and the dependencies your system requires.  Once that command is done, you can remove the USB flash drive and take it back to the disconnected computer.  Some errors in red text may show up about being unable to download files relative to translations but these can be safely ignored.</para>

		<para>Back at the disconnected computer, insert the USB flash drive.  Assuming you have opened a terminal and have navigated to the directory on the flash drive containing the two files you then enter: <userinput>sudo apt-offline install bundle.zip</userinput>.  You will see some program output scroll by and once it completes your repositories will be updated.  Once that completes, you can then install <application>$PACKAGENAME</application> by then entering: <userinput>sudo apt-get install $PACKAGENAME</userinput>.</para> 
	</section>

	<section id="offline-system-upgrade">
		<title>Upgrading Your System</title>

		<warning><para>A few specific packages are not built to handle the disconnected environment.  This is due to them running download scripts during the installation or upgrade process.  One package that routinely exhibits this behavior is <application>flashplugin-installer</application>.  The only way around this is to use a free alternative life <application>swf-dec</application> which comes complete in its package file.  Other packages will exhibit this behavior so you must be careful.</para></warning>

		<para>An upgrade of packages is a two-round process for those using a disconnected computer.  During the first round you need to update your computer's view of the repositories to know that something has an update available.  Only during the second round can you download the upgrade packages.</para>

		<para>First plug in a USB flash drive and open a terminal.  From your disconnected computer you enter this at the command line: <userinput>apt-offline set --update apt-offline.sig</userinput></para>

		<para>After that command is done and the <userinput>apt-offline.sig</userinput> is created, copy that to your USB flash drive and take it to another computer.  With apt-offline on that computer, you use that file to download what your disconnected computer needs to update itself.  Assuming you are in the terminal and in the directory on the flash drive containing <userinput>apt-offline.sig</userinput>, you enter <userinput>apt-offline get --bundle bundle.zip apt-offline.sig</userinput>.  Once that command is done, you can remove the USB flash drive and take it back to the disconnected computer.  Some errors in red text may show up about being unable to download files relative to translations but these can be safely ignored.</para>

		<para>Back at the disconnected computer, insert the USB flash drive.  Assuming you have opened a terminal and have navigated to the directory on the flash drive containing the two files you then enter: <userinput>sudo apt-offline install bundle.zip</userinput>.  You will see some program output scroll by and once it completes your repositories will be updated.</para> 

		<para>This completes the first part to the process.  You'll know now whether or not there are packages to upgrade.  If there are packages to upgrade you can continue onward otherwise it is okay to stop.</para> 

		<para>Clear the USB flash drive that you have used previously.  In a fresh terminal window, navigate to the directory on the USB flash drive you intend to work from.  Since we never want to lose the opportunity to refresh the disconnected machine's view of the repositories, we build the the command to not only look for upgrade packages but also to update repositories.  You will want to enter: <userinput>apt-offline set --update --upgrade apt-offline.sig</userinput></para> 

		<para>After that command is done and the <userinput>apt-offline.sig</userinput> is created, copy that to your USB flash drive and take it to another computer.  With apt-offline on that computer, you use that file to download what your disconnected computer needs to update itself.  Assuming you are in the terminal and in the directory on the flash drive containing <userinput>apt-offline.sig</userinput>, you enter <userinput>sudo apt-offline get --bundle bundle.zip apt-offline.sig</userinput>.  The command's output will show an attempt to download updates as to what the repositories look like as well as the upgrades as well as their dependencies that may be required by your system.  Once that command is done, you can remove the USB flash drive and take it back to the disconnected computer.  Some errors in red text may show up about being unable to download files relative to translations but these can be safely ignored.</para>

		<para>Back at the disconnected computer, insert the USB flash drive.  Assuming you have opened a terminal and have navigated to the directory on the flash drive containing the two files you then enter: <userinput>sudo apt-offline install bundle.zip</userinput>.  You will see some program output scroll by and once it completes your repositories will be updated.  Once that completes, you can then install the upgrades by entering: <userinput>sudo apt-get upgrade</userinput>.</para>

		<note><para>You will want to avoid the use of the <userinput>-y</userinput> flag when upgrading so that you get a last chance to look through your upgrades to see if any problems mentioned earlier like <application>flashplugin-installer</application> show up.  It takes just a moment but prevents some possible moments of grief later on.</para></note>
	</section>

	<section id="other-apt-offline-actions">
		<title>Other Actions</title>

		<para>The graphical tool <application>apt-offline-gui</application> helps you walk through the process for more complicated installations and upgrading applications while following the same basic steps as shown above.  As a mirror to the command-line tool's three modes, you have three buttons to enter specific forms to structure how you wish disconnected application management to proceed much like the steps above.  A key disadvantage, though, to the GUI is that helpful error messages are sometimes not passed along compared to the command line version.</para>

	</section>

</chapter>
